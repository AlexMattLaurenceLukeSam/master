USE csci222;

CREATE TABLE `UserType` (
	`userID` int NOT NULL,
	`confID` int NOT NULL,
	`userType` ENUM('author', 'pc', 'chair') NOT NULL DEFAULT 'author',
	`paidAmount` float NOT NULL DEFAULT 0,
	FOREIGN KEY(`userID`) REFERENCES UserAccount(`UserID`)
	FOREIGN KEY(`confID`) REFERENCES Conference(`confID`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

CREATE TABLE `UserAccount` (
	`userID` int NOT NULL AUTO_INCREMENT,
	`username` varchar(32) NOT NULL,
	`password` varchar(32) NOT NULL,
	`infoID` int NOT NULL,
	PRIMARY KEY(`userID`),
	FOREIGN KEY(`infoID`) REFERENCES PersonalInfo(`infoID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8;

CREATE TABLE `PersonalInfo` (
	`infoID` int NOT NULL AUTO_INCREMENT,
	`userID` int,
	`name` varchar(128) NOT NULL,
	`email` varchar(128),
	`organisation` varchar(256) NOT NULL,
	`phone` varchar(32), 
	PRIMARY KEY(`infoID`),
	FOREIGN KEY(`userID`) REFERENCES UserAccount(`UserID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8;

CREATE TABLE `Emails` (
	`emailID` int NOT NULL AUTO_INCREMENT,
	`userID` int NOT NULL,
	`confID` int NOT NULL,
	`emailType` ENUM(`accountCreation`, `accountModified`, `paperSubmitted`, `paperAssigned`, `paperReviewed`, `rebuttalNeeded`, `rebuttalSubmitted`, `biddingOpen`, `paperAccepted`, `paperRejected`, `ReviewersNeeded`, `AllPapersReviewed`, `invitationCommitte`, `invitationChair`, `softDeadline`, `hardDeadline`),
	PRIMARY KEY(`emailID`),
	FOREIGN KEY(`userID`) REFERENCES UserAccount(`UserID`)
	FOREIGN KEY(`confID`) REFERENCES Conference(`confID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8;

CREATE TABLE `ExpertiseArea` (
	`userID` int NOT NULL,
	`expertiseID` int NOT NULL,
	FOREIGN KEY(`userID`) REFERENCES UserAccount(`UserID`),
	FOREIGN KEY(`expertiseID`) REFERENCES Keywords(`keywordID`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

CREATE TABLE `Keywords` (
	`keywordID` int NOT NULL AUTO_INCREMENT,
	`keyword` varchar(64) NOT NULL,
	PRIMARY KEY(`expertiseID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8;

CREATE TABLE `Conference` (
	`confID` int NOT NULL AUTO_INCREMENT,
	`name` varchar(256) NOT NULL,
	`topic` varchar(512) NOT NULL,
	`description` varchar(4096) NOT NULL,
	`location` varchar(256) NOT NULL,
	`active` boolean NOT NULL DEFAULT 1,
	`paperDeadline` datetime,
	`paperDeadlineBool` bool,
	`reviewDeadlineSoft` datetime,
	`reviewDeadlineSoftBool` bool,
	`reviewDeadlineHard` datetime,
	`reviewDeadlineHardBool` bool,
	`discussDeadline` datetime,
	`discussDeadlineBool` bool,
	`reviewersPerPaper` int NOT NULL,
	PRIMARY KEY(`conf_id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8;

CREATE TABLE `ConferenceKeywords` (
	`confID` int,
	`keywordID` int,
	FOREIGN KEY(`confID`) REFERENCES Conference(`confID`),
	FOREIGN KEY(`keywordID`) REFERENCES Keywords(`keywordID`)

CREATE TABLE `Paper` (
	`paperID` int NOT NULL AUTO_INCREMENT,
	`leadAuthorID` int NOT NULL,
	`confID` int NOT NULL,
	`keywordID` int NOT NULL,
	`paperTitle` varchar(512) NOT NULL,
	`paperAbstract` varchar(4096) NOT NULL,
	`paperStatus` ENUM(`accepted`, `rejected`, submitted`, `assigned`, `reviewed`),
	`paper` blob NOT NULL,
	PRIMARY KEY(`paperID`),
	FOREIGN KEY(`leadAuthorID`) REFERENCES UserAccount(`userID`),
	FOREIGN KEY(`confID`) REFERENCES Conference(`confID`),
	FOREIGN KEY(`keywordID`) REFERENCES Keywords(`keywordID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8;

CREATE TABLE `AcceptedPapers` (
	`confID` int NOT NULL,
	`paperID` int NOT NULL,
	FOREIGN KEY(`confID`) REFERENCES Conference(`confID`),
	FOREIGN KEY(`paperID`) REFERENCES Paper(`paperID`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

CREATE TABLE `paperAuthors` (
	`paperID` int NOT NULL,
	`authorID` int NOT NULL,
	FOREIGN KEY(`paperID`) REFERENCES Paper(`paperID`)
	FOREIGN KEY(`authorID`) REFERENCES PersonalInfo(`infoID`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

CREATE TABLE `PaperKeywords` (
	`paperID` int NOT NULL,
	`keyword` varchar(64) NOT NULL,
	FOREIGN KEY(`paperID`) REFERENCES Paper(`paperID`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;

CREATE TABLE `PaperAssigned` (
	`paperID` int NOT NULL,
	`reviewerID` int NOT NULL,
	`reviewed` boolean NOT NULL DEFAULT 0,
	FOREIGN KEY(`paperID`) REFERENCES Paper(`paperID`),
	FOREIGN KEY(`reviewerID`) REFERENCES UserAccount(`userID`)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8;
	
CREATE TABLE `Review` (
	`reportID` int NOT NULL AUTO_INCREMENT,
	`paperID` int NOT NULL,
	`reviewerID` int NOT NULL,
	`confID` int NOT NULL,
	`overall` int,
	`confidence` int,
	`relevance` int,
	`originality` int,
	`significance` int,
	`presentation` int,
	`techQuality` int,
	`evaluation` int,
	`commentsStrength` varchar(4096),
	`commentsWeakness` varchar(4096),
	`commentsSuggestions` varchar(4096),
	`commentsShortPaper` varchar(4096),
	`commentsBestAward` varchar(4096),
	`authorRebuttal` varchar(4096),
	PRIMARY KEY(`report_id`),
	FOREIGN KEY(`paperID`) REFERENCES Paper(`paperID`)
	FOREIGN KEY(`reviewerID`) REFERENCES UserAccount(`userID`)
	FOREIGN KEY(`confID`) REFERENCES Conference(`confID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8;

CREATE TABLE `ReviewerDiscussion` (
	`commentID` int NOT NULL AUTO_INCREMENT,
	`paperID` int NOT NULL,
	`confID` int NOT NULL,
	`reviewerID` int NOT NULL,
	`comment` varchar(4096),
	PRIMARY KEY(`commentID`),
	FOREIGN KEY(`paperID`) REFERENCES Paper(`paperID`),
	FOREIGN KEY(`confID`) REFERENCES Conference(`confID`),
	FOREIGN KEY(`reviewerID`) REFERENCES UserAccount(`userID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=UTF8;

